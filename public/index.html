<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <!-- avoid favicon requests -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>Wx Station</title>
    <script type="text/javascript">
        "use strict";

        const up = "↑";
        const down = "↓";
        let lastTemp, lastPress, lastHumid = 0;

        Number.prototype.pad = function (size) {
            var s = String(this);
            while (s.length < (size || 2)) { s = "0" + s; }
            return s;
        }

        getLocation();

        function updateValues() {
            getValues();
            setInterval(() => {
                getValues();
                console.log(".");
            }, 60 * 1000);
        }

        function getLocation() {
            fetch("/api/v1/location/1", { method: "get" })
                .then(response => response.json())
                .then(jsonData => {
                    document.getElementById("location").innerText =  jsonData[0].description;
                    lastTemp = jsonData[0].temperature;
                })
                .catch(err => {
                    console.log(err);
                });
        }

        function getValues() {
            fetch("/api/v1/temperature/1", { method: "get" })
                .then(response => response.json())
                .then(jsonData => {
                    let indicator = "";
                    if (lastTemp < jsonData[0].temperature) indicator = up;
                    if (lastTemp > jsonData[0].temperature) indicator = down;
                    document.getElementById("temperature").text =  jsonData[0].temperature + "°" + indicator;
                    lastTemp = jsonData[0].temperature;
                })
                .catch(err => {
                    console.log(err);
                });
            fetch("/api/v1/pressure/1", { method: "get" })
                .then(response => response.json())
                .then(jsonData => {
                    let indicator = "";
                    if (lastPress < jsonData[0].pressure) indicator = up;
                    if (lastPress > jsonData[0].pressure) indicator = down;
                    document.getElementById("pressure").text = jsonData[0].pressure + indicator;
                    lastPress = jsonData[0].pressure;
                })
                .catch(err => {
                    console.log(err);
                });
            fetch("/api/v1/humidity/1", { method: "get" })
                .then(response => response.json())
                .then(jsonData => {
                    let indicator = "";
                    if (lastHumid < jsonData[0].humidity) indicator = up;
                    if (lastHumid > jsonData[0].humidity) indicator = down;
                    document.getElementById("humidity").text = jsonData[0].humidity + "%" + indicator;
                    let ts = new Date(jsonData[0].time);
                    document.getElementById("timestamp").innerText = ts.getMonth() + 1 + "/" + ts.getDate()
                        + "  " + ts.getHours() + ":" + ts.getMinutes().pad();
                    lastHumid = jsonData[0].humidity;
                })
                .catch(err => {
                    console.log(err);
                });
        }

    </script>

</head>

<body style="background-color:black; font-family: 'Lucida Sans', sans-serif;" onload="updateValues();">

    <div class="container-fluid" style="padding: 100px; margin: auto;">
        <div class="row">
            <div class="col-lg-4" style="font-size: 8vw; font-weight: bold;">
                <a id="temperature" style="color: white; text-decoration: none;" href=""></a>
            </div>
            <div class="col-lg-5" style="font-size: 8vw; font-weight: bold;">
                <a id="pressure" style="color: white; text-decoration: none;" href=""></a>
            </div>>
            <div class="col-lg-2" style="font-size: 8vw; font-weight: bold;">
                <a id="humidity" style="color: white; text-decoration: none;" href=""></a>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-4" id="timestamp" style="font-size: 3vw; color: white;">
            </div>
            <div class="col-lg-6" id="location" style="font-size: 3vw; color: white;">
            </div>
        </div>
    </div>
    </div>

</body>

</html>